<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>David Unterberger</title>

  <!-- Monospace -->
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400;600;800&display=swap"
    rel="stylesheet">

  <!-- Tailwind dev CDN (ok for quick deploy) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    // Keep the redirect guard you wanted
    const allowedHost = "david-unterberger-info.vercel.app";
    if (window.location.hostname !== allowedHost) {
      window.location.replace("https://" + allowedHost + window.location.pathname + window.location.search);
    }
  </script>

  <style>
    :root {
      --crt-bg: #030302;
      --crt-orange: #ff9800;
      --crt-dim: #2f1a07;
      --crt-soft: rgba(255, 152, 0, 0.03);
      --muted: #9e7a52;
      --accent: #b56fff;
    }

    html,
    body,
    #root {
      height: 100%;
      margin: 0;
      font-family: "Source Code Pro", monospace;
      background: var(--crt-bg);
      color: var(--crt-orange);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      letter-spacing: 0.2px;
    }

    /* Terrain canvas sits behind everything */
    #terrain {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* Root content is above terrain */
    #root {
      position: relative;
      z-index: 5;
    }

    /* CENTRAL PANEL - single continuous terminal section */
    .center-shell {
      max-width: 1100px;
      margin: 6vh auto;
      background: rgba(0, 0, 0, 0.65);
      /* a bit darker */
      border: 1px solid var(--crt-dim);
      padding: 28px;
      color: var(--crt-orange);
      overflow: visible;
      box-sizing: border-box;
      border-radius: 6px;
    }

    /* Remove glows, keep crisp terminal look */
    .glass,
    .terminal-box {
      background: transparent;
      box-shadow: none;
      border-radius: 0;
      padding: 0;
    }

    /* module wrapper */
    .module {
      border-top: 1px solid var(--crt-dim);
      padding: 16px 0;
    }

    /* small terminal separators */
    .term-sep {
      color: var(--muted);
      margin: 8px 0;
      font-size: 0.95rem;
    }

    /* headings and cursor */
    .section-title {
      font-size: 0.98rem;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--crt-orange);
    }

    .section-title.cursor::after {
      content: "_";
      margin-left: 8px;
      opacity: 1;
      animation: blink 1s steps(2) infinite;
    }

    @keyframes blink {
      50% {
        opacity: 0;
      }
    }

    /* boxes for small grouped data (no glow) */
    .data-box {
      background: rgba(0, 0, 0, 0.18);
      border: 1px solid var(--crt-dim);
      padding: 8px;
      font-size: 0.92rem;
    }

    /* image styling (keeps avatars and headers crisp) */
    img.avatar {
      width: 72px;
      height: 72px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid var(--crt-dim);
    }

    img.repo-thumb {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border: 1px solid var(--crt-dim);
    }

    img.game-header {
      width: 100%;
      height: 96px;
      object-fit: cover;
      border: 1px solid var(--crt-dim);
    }

    /* activity art container fit */
    .activity-art {
      width: 128px;
      height: 72px;
      overflow: hidden;
      border: 1px solid var(--crt-dim);
      background: #000;
    }

    .activity-art img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    /* bigger weather block */
    .weather-large {
      display: flex;
      gap: 18px;
      align-items: center;
      background: rgba(0, 0, 0, 0.12);
      border: 1px solid var(--crt-dim);
      padding: 18px;
      font-size: 1.05rem;
    }

    .weather-temp {
      font-size: 2.6rem;
      font-weight: 700;
      color: var(--crt-orange);
    }

    /* typography utilities */
    .mono {
      font-family: "Source Code Pro", monospace;
    }

    .muted {
      color: var(--muted);
    }

    .small {
      font-size: 0.92rem;
    }

    /* scanlines overlay subtle */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: repeating-linear-gradient(to bottom,
          rgba(0, 0, 0, 0) 0px,
          rgba(0, 0, 0, 0) 2px,
          rgba(0, 0, 0, 0.03) 3px,
          rgba(0, 0, 0, 0.03) 4px);
      z-index: 2;
      mix-blend-mode: overlay;
      opacity: 0.45;
    }

    /* subtle tube flicker */
    @keyframes tubeFlicker {
      0% {
        opacity: .99;
        filter: none;
      }

      50% {
        opacity: 1;
        filter: none;
      }

      100% {
        opacity: .995;
        filter: none;
      }
    }

    .center-shell {
      animation: tubeFlicker 4s infinite;
    }

    /* typewriter reveal (JS sets visible text) */
    .type-hidden {
      color: transparent;
      white-space: pre-wrap;
    }

    .type-visible {
      color: var(--crt-orange);
    }

    /* small responsive */
    @media (max-width:768px) {
      .center-shell {
        margin: 3vh 12px;
        padding: 16px;
      }

      img.avatar {
        width: 56px;
        height: 56px;
      }

      .activity-art {
        width: 96px;
        height: 56px;
      }

      .weather-temp {
        font-size: 2.0rem;
      }
    }
  </style>
</head>

<body>
  <canvas id="terrain"></canvas>

  <div id="root">
    <div class="center-shell">
      <!-- ASCII-ish banner -->
      <div style="text-align:center; margin-bottom:12px;">
        <pre class="mono" style="margin:0; font-size:0.95rem; line-height:1;">
  ____    _    _   _ ___ ___ _   _  _   _  _   _
 |  _ \  / \  | \ | |_ _/ __| \ | || \ | || \ | |
 | | | |/ _ \ |  \| || | (_ |  \| ||  \| ||  \| |
 | |_| / ___ \| |\  || |\___| |\  || |\  || |\  |
 |____/_/   \_\_| \_|___|    |_| \_||_| \_||_| \_|
        </pre>
        <div class="term-sep muted mono">========================================</div>
      </div>

      <!-- HERO (static title + tagline) -->
      <div class="module">
        <div class="section-title cursor typewriter" data-type-speed="18">:: david unterberger</div>
        <div class="term-sep muted"></div>
        <div class="mono small typewriter" data-type-speed="6">
          Hobby game developer since 2020. Focused on procedural terrain, simulation systems and shader experimentation.
        </div>
      </div>

      <!-- One continuous content stack below -->
      <div class="module" id="content-stack">

        <!-- Current project -->
        <div style="margin-bottom:18px;">
          <div class="section-title small">:: current project</div>
          <div class="term-sep muted">------------------------------------------</div>

          <div style="display:flex; gap:16px; align-items:flex-start; margin-top:8px;">
            <!-- left: project text -->
            <div style="flex:1;">
              <div class="mono small">
                <div style="font-weight:700; color:var(--crt-orange)">Procedural Terrain & Shader Engine Experiments
                </div>
                <div class="muted small" style="margin-top:6px;">
                  Building modular terrain systems using layered noise stacks, runtime mesh deformation and custom
                  shader pipelines.
                  Exploring simulation-driven world generation.
                </div>
                <div class="muted small" style="margin-top:8px;">
                  TAGS: C# • Shaders • Procedural Gen • Simulation
                </div>
                <div style="margin-top:8px;">
                  <a href="https://github.com/David-Unterberger" target="_blank" rel="noreferrer">github</a> • <a
                    href="https://davebbx.itch.io" target="_blank" rel="noreferrer">itch.io</a>
                </div>
              </div>
            </div>

            <!-- right: small mock preview image area (keeps imagery) -->
            <div style="width:220px;">
              <!-- placeholder or project cover (uses title background if available) -->
              <img src="titel_background.png" alt="project"
                style="width:220px; height:120px; object-fit:cover; border:1px solid var(--crt-dim)" />
            </div>
          </div>
        </div>

        <!-- Discord module -->
        <div style="margin-bottom:18px;">
          <div class="section-title small">:: discord</div>
          <div class="term-sep muted">------------------------------------------</div>

          <!-- Discord content rendered by React -->
          <div id="discord-mount" />
        </div>

        <!-- Steam module -->
        <div style="margin-bottom:18px;">
          <div class="section-title small">:: steam</div>
          <div class="term-sep muted">------------------------------------------</div>

          <div id="steam-mount"></div>
        </div>

        <!-- GitHub module -->
        <div style="margin-bottom:18px;">
          <div class="section-title small">:: github</div>
          <div class="term-sep muted">------------------------------------------</div>

          <div id="github-mount"></div>
        </div>

        <!-- Weather module (larger) -->
        <div style="margin-bottom:6px;">
          <div class="section-title small">:: salzburg weather</div>
          <div class="term-sep muted">------------------------------------------</div>

          <div id="weather-mount" style="margin-top:8px;"></div>
        </div>

        <div style="margin-top:14px; text-align:center;" class="muted mono small">David Unterberger</div>
      </div>
    </div>
  </div>

  <!-- React app script -->
  <script type="text/babel">
    const { useState, useEffect } = React;
    const DISCORD_ID = "780384263987920937";
    const STEAM_ID = "76561199474685726";
    const GITHUB_USER = "David-Unterberger";

    /* --- UTIL: Typewriter reveal for elements with class 'typewriter' --- */
    function runTypewriterOnce() {
      // run once after first render
      const nodes = document.querySelectorAll('.typewriter');
      nodes.forEach(el => {
        if (el.dataset._typed) return; // already ran
        el.dataset._typed = "1";
        const full = el.textContent.trim();
        el.textContent = "";
        el.classList.add('type-hidden');
        const speed = parseInt(el.getAttribute('data-type-speed') || '12', 10);
        let i = 0;
        const id = setInterval(() => {
          el.textContent += full[i] || "";
          i++;
          if (i >= full.length) {
            clearInterval(id);
            el.classList.remove('type-hidden');
            el.classList.add('type-visible');
          }
        }, speed);
      });
    }

    /* ---------------- DISCORD COMPONENT (renders into #discord-mount) ---------------- */
    function DiscordComponent({ rootId }) {
      const [data, setData] = useState(null);
      const [elapsed, setElapsed] = useState("");

      useEffect(() => {
        let mounted = true;
        async function fetchPresence() {
          try {
            const r = await fetch(`https://api.lanyard.rest/v1/users/${DISCORD_ID}`);
            const json = await r.json();
            if (json.success && mounted) setData(json.data);
          } catch (e) { }
        }
        fetchPresence();
        const id = setInterval(fetchPresence, 15000);
        return () => { mounted = false; clearInterval(id); };
      }, []);

      const activity = data?.activities?.find(a => a.type === 0);

      useEffect(() => {
        if (!activity?.timestamps?.start) { setElapsed(""); return; }
        function update() {
          const start = Number(activity.timestamps.start);
          const diff = Date.now() - start;
          const h = Math.floor(diff / (1000 * 60 * 60));
          const m = Math.floor((diff / (1000 * 60)) % 60);
          setElapsed(h > 0 ? `${h}h ${m}m` : `${m}m`);
        }
        update();
        const id = setInterval(update, 60000);
        return () => clearInterval(id);
      }, [activity]);

      if (!data) return null;

      const user = data.discord_user;
      const status = data.discord_status || "offline";
      const customStatus = data.activities?.find(a => a.type === 4);

      let accountAgeDays = null;
      try {
        const snowflake = BigInt(user.id);
        const timestamp = Number((snowflake >> 22n) + 1420070400000n);
        accountAgeDays = Math.floor((Date.now() - timestamp) / (1000 * 60 * 60 * 24));
      } catch { }

      function getActivityImage(act) {
        if (!act?.assets?.large_image) {
          // VS Code fallback
          if (typeof act?.name === "string" && /visual studio|code/i.test(act.name)) {
            return "https://upload.wikimedia.org/wikipedia/commons/9/9a/Visual_Studio_Code_1.35_icon.svg";
          }
          return null;
        }
        const large = act.assets.large_image;
        if (typeof large === "string" && large.startsWith("mp:")) return `https://media.discordapp.net/${large.replace("mp:", "")}`;
        if (act.application_id) return `https://cdn.discordapp.com/app-assets/${act.application_id}/${large}.png`;
        return null;
      }

      const party = activity?.party?.size;

      // render DOM nodes (not full React render into original structure) — keep simple
      return (
        <div className="mono small">
          <div>USER............. <span style={{ color: "var(--crt-orange)", fontWeight: 700 }}>{user.username}</span></div>
          <div>STATUS........... <span className="muted">{status}</span></div>
          {accountAgeDays !== null && <div>ACCOUNT_AGE...... <span className="muted">{accountAgeDays} days</span></div>}
          {customStatus?.state && <div>CUSTOM_STATUS.... <span className="muted">{customStatus.emoji?.name} {customStatus.state}</span></div>}

          {activity && (
            <div style={{ marginTop: 12, display: "flex", gap: 12 }}>
              <div className="activity-art">
                {getActivityImage(activity) ? <img src={getActivityImage(activity)} alt="act" /> : <div style={{ padding: 8 }} className="muted small">No art</div>}
              </div>
              <div style={{ flex: 1 }}>
                <div style={{ fontWeight: 700 }}>{activity.name}</div>
                {activity.details && <div className="muted small">{activity.details}</div>}
                {activity.state && <div className="muted small">{activity.state}</div>}
                {elapsed && <div className="muted small" style={{ marginTop: 8 }}>{elapsed} elapsed</div>}
                {party && <div className="muted small" style={{ marginTop: 6 }}>Party: {party[0]} / {party[1]}</div>}
              </div>
            </div>
          )}

          <div style={{ height: 12 }} />

          <div style={{ display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 10 }}>
            <div className="data-box">
              <div className="muted small">Status</div>
              <div className="mono">{status}</div>
            </div>
            <div className="data-box">
              <div className="muted small">Activities</div>
              <div className="mono">{data.activities?.filter(a => a.type !== 4).length}</div>
            </div>
            <div className="data-box">
              <div className="muted small">User ID</div>
              <div className="mono small break-all">{user.id}</div>
            </div>
            <div className="data-box">
              <div className="muted small">Public Flags</div>
              <div className="mono">{user.public_flags || 0}</div>
            </div>
          </div>
        </div>
      );
    }

    /* ---------------- STEAM COMPONENT ---------------- */
    function SteamComponent() {
      const [data, setData] = useState(null);
      const [error, setError] = useState(false);

      useEffect(() => {
        fetch("/api/steam")
          .then(r => { if (!r.ok) throw new Error("steam fetch"); return r.json(); })
          .then(d => setData(d))
          .catch(() => setError(true));
      }, []);

      if (error) return (<div className="muted">Steam data unavailable.</div>);
      if (!data) return null;

      const profile = data.profile || {};
      const owned = data.owned || { game_count: 0 };
      const topPlayed = (data.topPlayed || []).slice(0, 9);
      const recent = (data.recent?.games || []).slice(0, 3);
      const totalHours = data.totalHours || 0;

      function fmt(sec) { if (!sec) return "Unknown"; return new Date(sec * 1000).toLocaleString(); }

      return (
        <div className="mono small">
          <div>PROFILE.......... <span style={{ color: "var(--crt-orange)", fontWeight: 700 }}>{profile.personaname}</span></div>
          <div>TOTAL_GAMES...... <span className="muted">{owned.game_count || 0}</span></div>
          <div>TOTAL_HOURS...... <span className="muted">{totalHours} hrs</span></div>
          <div>CREATED.......... <span className="muted">{fmt(profile.timecreated)}</span></div>
          <div>LAST_LOGOFF...... <span className="muted">{fmt(profile.lastlogoff)}</span></div>

          <div style={{ height: 10 }} />

          <div className="muted small">-- recently played --</div>
          {recent.map((g, i) => (
            <div key={g.appid} style={{ display: "flex", gap: 12, alignItems: "center", paddingTop: 8 }}>
              <img className="game-header" src={`https://cdn.cloudflare.steamstatic.com/steam/apps/${g.appid}/header.jpg`} alt={g.name} />
              <div style={{ flex: 1 }}>
                <div style={{ fontWeight: 700 }}>{g.name}</div>
                <div className="muted small">{Math.round((g.playtime_2weeks || 0) / 60)}h last 2 weeks</div>
              </div>
            </div>
          ))}

          <div style={{ height: 10 }} />

          <div className="muted small">-- top played --</div>
          {topPlayed.map((g, i) => (
            <div key={g.appid} style={{ display: "flex", gap: 12, alignItems: "center", paddingTop: 8 }}>
              <img className="game-header" src={`https://cdn.cloudflare.steamstatic.com/steam/apps/${g.appid}/header.jpg`} alt={g.name} />
              <div style={{ flex: 1 }}>
                <div style={{ fontWeight: 700 }}>[{String(i + 1).padStart(2, '0')}] {g.name}</div>
                <div className="muted small">{Math.round((g.playtime_forever || 0) / 60)}h total{g.completion_percent !== null ? ` • ${g.completion_percent}%` : ''}</div>
              </div>
            </div>
          ))}
        </div>
      );
    }

    /* ---------------- GITHUB COMPONENT ---------------- */
    function GithubComponent() {
      const [profile, setProfile] = useState(null);
      const [repos, setRepos] = useState([]);

      useEffect(() => {
        fetch(`https://api.github.com/users/${GITHUB_USER}`).then(r => r.json()).then(setProfile).catch(() => { });
        fetch(`https://api.github.com/users/${GITHUB_USER}/repos?per_page=100&sort=pushed`).then(r => r.json()).then(list => Array.isArray(list) && setRepos(list)).catch(() => { });
      }, []);

      if (!profile) return null;

      const totals = repos.reduce((acc, r) => { acc.stars += r.stargazers_count || 0; acc.forks += r.forks_count || 0; if (r.language) acc.langCount[r.language] = (acc.langCount[r.language] || 0) + 1; if (!acc.top || r.stargazers_count > acc.top.stars) acc.top = { name: r.name, stars: r.stargazers_count, url: r.html_url }; return acc; }, { stars: 0, forks: 0, langCount: {}, top: null });
      const mostUsed = Object.entries(totals.langCount).sort((a, b) => b[1] - a[1])[0]?.[0] || "Unknown";
      const contributionsSvg = `https://ghchart.rshah.org/${GITHUB_USER}`;

      return (
        <div className="mono small">
          <div>USER............. <span style={{ color: "var(--crt-orange)", fontWeight: 700 }}>{profile.name || profile.login}</span></div>
          <div>BIO.............. <span className="muted">{profile.bio || '—'}</span></div>
          <div>PUBLIC_REPOS..... <span className="muted">{profile.public_repos}</span></div>
          <div>TOTAL_STARS...... <span className="muted">{totals.stars}</span></div>
          <div>TOTAL_FORKS...... <span className="muted">{totals.forks}</span></div>
          <div>TOP_LANGUAGE..... <span className="muted">{mostUsed}</span></div>
          {totals.top && <div style={{ marginTop: 6 }}>MOST_STARRED..... <a href={totals.top.url} target="_blank" rel="noreferrer" className="muted">{totals.top.name} ({totals.top.stars}★)</a></div>}

          <div style={{ height: 12 }} />

          <div className="data-box" style={{ padding: 12 }}>
            <div className="muted small">Contribution graph</div>
            <img src={contributionsSvg} alt="contribs" style={{ width: '100%', marginTop: 8 }} />
          </div>

          <div style={{ height: 12 }} />

          <div className="muted small">-- top repositories --</div>
          {repos.slice(0, 6).map(r => (
            <div key={r.id} style={{ display: "flex", justifyContent: "space-between", paddingTop: 8 }}>
              <a href={r.html_url} target="_blank" rel="noreferrer" style={{ color: "var(--crt-orange)" }}>{r.name}</a>
              <div className="muted small">★{r.stargazers_count}</div>
            </div>
          ))}
        </div>
      );
    }

    /* ---------------- WEATHER COMPONENT ---------------- */
    function WeatherComponent() {
      const [weather, setWeather] = useState(null);
      useEffect(() => { fetch("https://api.open-meteo.com/v1/forecast?latitude=47.8095&longitude=13.0550&current_weather=true").then(r => r.json()).then(d => setWeather(d.current_weather)).catch(() => { }); }, []);
      if (!weather) return null;

      const glyph = weather.temperature > 20 ? '☀️' : (weather.temperature > 8 ? '⛅' : '❄️');
      return (
        <div className="weather-large mono">
          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', width: 120 }}>
            <div style={{ fontSize: 38 }}>{glyph}</div>
            <div className="muted small">Salzburg</div>
          </div>
          <div>
            <div className="weather-temp">{weather.temperature}°C</div>
            <div className="muted small">Wind {weather.windspeed} km/h</div>
            <div style={{ height: 8 }} />
            <div className="muted small">Updated now</div>
          </div>
        </div>
      );
    }

    /* ---------------- APP (mount components into prebuilt slots) ---------------- */
    function MainApp() {
      useEffect(() => {
        setTimeout(() => runTypewriterOnce(), 350);
      }, []);

      return (
        <>
          <DiscordComponent />
          <SteamComponent />
          <GithubComponent />
          <WeatherComponent />
        </>
      );
    }
    ReactDOM.createRoot(document.getElementById('discord-mount')).render(<DiscordComponent />);
    ReactDOM.createRoot(document.getElementById('steam-mount')).render(<SteamComponent />);
    ReactDOM.createRoot(document.getElementById('github-mount')).render(<GithubComponent />);
    ReactDOM.createRoot(document.getElementById('weather-mount')).render(<WeatherComponent />);

    setTimeout(() => runTypewriterOnce(), 350);
  </script>

  <!-- Terrain animation (behind) - color tuned to orange -->
  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('terrain'), alpha: true, antialias: true });
    renderer.setClearColor(0x000000, 0);
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.position.z = 30;

    const geometry = new THREE.PlaneGeometry(120, 120, 120, 120);
    const material = new THREE.MeshBasicMaterial({ color: 0xff8a2b, wireframe: true, transparent: true, opacity: 0.06 });
    const plane = new THREE.Mesh(geometry, material);
    plane.rotation.x = -Math.PI / 2.7;
    scene.add(plane);

    function animate() {
      requestAnimationFrame(animate);
      const t = Date.now() * 0.0003;
      const pos = plane.geometry.attributes.position;
      for (let i = 0; i < pos.count; i++) {
        const x = pos.getX(i), y = pos.getY(i);
        pos.setZ(i, Math.sin(x * 0.2 + t) * 0.4 + Math.cos(y * 0.25 + t) * 0.4);
      }
      pos.needsUpdate = true;
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>

</html>