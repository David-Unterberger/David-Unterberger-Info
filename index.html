<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>David Unterberger</title>

<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<style>
html,body,#root{
  margin:0;
  background:#0f1214;
  color:#e8eef1;
  font-family:"Source Code Pro", monospace;
  overflow-x:hidden;
}
.hero-bg{
  background-image:
    linear-gradient(to bottom, rgba(0,0,0,0.75), rgba(0,0,0,0.9)),
    url("titel_background.png");
  background-size:cover;
  background-position:center;
  background-attachment:fixed;
}
.glass{
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.06);
  backdrop-filter:blur(10px);
}
.status-dot{
  width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:8px;
}
.online{background:#23a55a;box-shadow:0 0 10px #23a55a;}
.idle{background:#f0b232;}
.dnd{background:#f23f43;}
.offline{background:#80848e;}
.fade-in{
  opacity:0;transform:translateY(20px);
  animation:fade 1s ease forwards;
}
@keyframes fade{
  to{opacity:1;transform:translateY(0);}
}
#terrain{
  position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;
}
</style>
</head>
<body>

<canvas id="terrain"></canvas>
<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useRef} = React;

const DISCORD_ID="780384263987920937";
const STEAM_ID="76561199474685726";
const GITHUB_USER="David-Unterberger";

/* ---------------- HERO ---------------- */

function Hero(){
  const roles=["Game Developer","Systems Programmer","Procedural Enthusiast"];
  const [i,setI]=useState(0);
  useEffect(()=>{
    const t=setInterval(()=>setI(x=>(x+1)%roles.length),3000);
    return()=>clearInterval(t);
  },[]);
  return(
    <section className="hero-bg min-h-screen flex flex-col justify-center items-center text-center px-6">
      <h1 className="text-5xl md:text-6xl font-bold mb-6">
        David Unterberger
      </h1>
      <p className="text-lg text-zinc-300 max-w-2xl mb-6">
        Hobby game developer since 2020. Focused on procedural terrain, simulation systems and shader experimentation.
      </p>
      <div className="text-xl text-violet-400">{roles[i]}</div>
    </section>
  );
}

/* ---------------- DISCORD ---------------- */

function Discord(){
  const [data,setData]=useState(null);
  const [elapsed,setElapsed]=useState("");
  useEffect(()=>{
    const ws=new WebSocket("wss://api.lanyard.rest/socket");
    ws.onopen=()=>ws.send(JSON.stringify({op:2,d:{subscribe_to_id:DISCORD_ID}}));
    ws.onmessage=(e)=>{
      const p=JSON.parse(e.data);
      if(p.t==="INIT_STATE"||p.t==="PRESENCE_UPDATE") setData(p.d);
    };
    return()=>ws.close();
  },[]);
  useEffect(()=>{
    if(!data) return;
    const act=data.activities?.find(a=>a.type===0);
    if(!act?.timestamps?.start) return;
    const int=setInterval(()=>{
      const diff=Date.now()-act.timestamps.start;
      const m=Math.floor(diff/60000);
      const s=Math.floor((diff%60000)/1000);
      setElapsed(`${m}m ${s}s`);
    },1000);
    return()=>clearInterval(int);
  },[data]);

  if(!data) return null;
  const status=data.discord_status;
  const activity=data.activities?.find(a=>a.type===0);
  let img=null;
  if(activity?.assets?.large_image){
    img=activity.assets.large_image.startsWith("mp:")
      ?`https://media.discordapp.net/${activity.assets.large_image.replace("mp:","")}`
      :`https://cdn.discordapp.com/app-assets/${activity.application_id}/${activity.assets.large_image}.png`;
  }

  return(
    <section className="max-w-5xl mx-auto px-6 py-16 fade-in">
      <h2 className="text-2xl font-bold mb-8">Discord</h2>
      <div className="glass p-6 rounded-xl max-w-md">
        <div className="flex items-center mb-4">
          <span className={`status-dot ${status}`}></span>
          <span className="capitalize">{status}</span>
        </div>
        {activity?(
          <>
            {img&&<img src={img} className="rounded mb-4"/>}
            <div className="text-zinc-400 text-sm">Playing</div>
            <div className="font-semibold">{activity.name}</div>
            <div className="text-sm text-zinc-500">{elapsed} elapsed</div>
          </>
        ):<div className="text-zinc-500 text-sm">No active game.</div>}
      </div>
    </section>
  );
}

/* ---------------- STEAM ---------------- */

function Steam(){
  const [games,setGames]=useState([]);

  useEffect(()=>{
    fetch(`https://corsproxy.io/?https://api.steampowered.com/IPlayerService/GetRecentlyPlayedGames/v1/?key=DEMO_KEY&steamid=${STEAM_ID}&format=json`)
    .then(r=>r.json())
    .then(d=>{
      setGames(d.response?.games?.slice(0,3)||[]);
    })
    .catch(()=>{});
  },[]);

  return(
    <section className="max-w-5xl mx-auto px-6 py-16 fade-in">
      <h2 className="text-2xl font-bold mb-8">Steam</h2>
      <div className="grid md:grid-cols-3 gap-6">
        {games.length===0?
          <div className="text-zinc-500">Steam data unavailable (API limit).</div>
        :
          games.map(g=>(
            <div key={g.appid} className="glass p-4 rounded-xl">
              <img src={`https://cdn.cloudflare.steamstatic.com/steam/apps/${g.appid}/header.jpg`} className="rounded mb-3"/>
              <div className="font-semibold">{g.name}</div>
              <div className="text-sm text-zinc-500">{Math.round(g.playtime_forever/60)} hrs</div>
            </div>
          ))
        }
      </div>
    </section>
  );
}

/* ---------------- GITHUB ---------------- */

function Github(){
  const [repos,setRepos]=useState([]);
  useEffect(()=>{
    fetch(`https://api.github.com/users/${GITHUB_USER}/repos`)
    .then(r=>r.json())
    .then(d=>setRepos(d.slice(0,6)));
  },[]);
  return(
    <section className="max-w-5xl mx-auto px-6 py-16 fade-in">
      <h2 className="text-2xl font-bold mb-8">GitHub</h2>
      <div className="grid md:grid-cols-3 gap-6">
        {repos.map(r=>(
          <a key={r.id} href={r.html_url} target="_blank" className="glass p-4 rounded-xl hover:scale-105 transition">
            <div className="font-semibold">{r.name}</div>
            <div className="text-sm text-zinc-400">{r.language}</div>
            <div className="text-sm text-zinc-500">⭐ {r.stargazers_count}</div>
          </a>
        ))}
      </div>
    </section>
  );
}

/* ---------------- WEATHER ---------------- */

function Weather(){
  const [weather,setWeather]=useState(null);
  useEffect(()=>{
    fetch("https://api.open-meteo.com/v1/forecast?latitude=47.8095&longitude=13.0550&current_weather=true")
    .then(r=>r.json())
    .then(d=>setWeather(d.current_weather));
  },[]);
  if(!weather) return null;
  return(
    <section className="max-w-5xl mx-auto px-6 py-16 fade-in">
      <h2 className="text-2xl font-bold mb-8">Salzburg Weather</h2>
      <div className="glass p-6 rounded-xl max-w-sm">
        <div className="text-3xl font-bold">{weather.temperature}°C</div>
        <div className="text-zinc-500">Wind {weather.windspeed} km/h</div>
      </div>
    </section>
  );
}

/* ---------------- APP ---------------- */

function App(){
  return(
    <>
      <Hero/>
      <Discord/>
      <Steam/>
      <Github/>
      <Weather/>
      <footer className="text-center py-12 text-zinc-500">
        David Unterberger
      </footer>
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>

<script>
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({canvas:document.getElementById("terrain"),alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
camera.position.z=30;
const geometry=new THREE.PlaneGeometry(100,100,100,100);
const material=new THREE.MeshBasicMaterial({color:0x0f4d3f,wireframe:true,transparent:true,opacity:0.15});
const plane=new THREE.Mesh(geometry,material);
plane.rotation.x=-Math.PI/2.8;
scene.add(plane);
function animate(){
  requestAnimationFrame(animate);
  const t=Date.now()*0.0005;
  const pos=plane.geometry.attributes.position;
  for(let i=0;i<pos.count;i++){
    const x=pos.getX(i);
    const y=pos.getY(i);
    pos.setZ(i,Math.sin(x*0.3+t)*0.5+Math.cos(y*0.3+t)*0.5);
  }
  pos.needsUpdate=true;
  renderer.render(scene,camera);
}
animate();
window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>

</body>
</html>
