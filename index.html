<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>David Unterberger</title>

  <!-- Source Code Pro (keeps it monospace / terminal-like) -->
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- Tailwind (dev CDN; fine for now) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

  <script>
    // Redirect only if not on Vercel host
    const allowedHost = "david-unterberger-info.vercel.app";
    if (window.location.hostname !== allowedHost) {
      window.location.replace("https://" + allowedHost + window.location.pathname + window.location.search);
    }
  </script>

  <style>
    /*
      CRT Terminal Theme
      - Orange phosphor text
      - Subtle scanlines, flicker, tube glow
      - Terminal boxes instead of glass
    */

    :root{
      --crt-bg: #030302;
      --crt-orange: #ff9800;       /* main phosphor */
      --crt-dim: #4b2b00;          /* border / dim */
      --crt-glow: rgba(255,152,0,0.14);
      --crt-soft: rgba(255,152,0,0.03);
      --muted: #9e7a52;
      --accent: #b56fff; /* small neon accent where needed */
    }

    html,body,#root{
      height:100%;
      margin:0;
      font-family:"Source Code Pro", monospace;
      background: radial-gradient(circle at 40% 30%, rgba(255,152,0,0.03), transparent 20%), var(--crt-bg);
      color: var(--crt-orange);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      text-shadow: 0 0 6px rgba(255,152,0,0.08);
      letter-spacing:0.2px;
    }

    /* Global small UI */
    a { color: var(--crt-orange); }
    a:hover { color: var(--accent); text-decoration: underline; }

    /* Replace .glass with terminal style (keeps HTML changes minimal) */
    .glass {
      background: rgba(0,0,0,0.45);
      border: 1px solid var(--crt-dim);
      padding: 0.75rem;
      box-shadow: 0 0 24px var(--crt-glow);
      color: var(--crt-orange);
      backdrop-filter: none;
      border-radius: 4px;
    }

    /* Headings */
    h1, h2, h3 {
      font-variant: all-small-caps;
      color: var(--crt-orange);
      letter-spacing:1px;
    }

    /* Terminal box look for big panels */
    .terminal-box {
      border: 1px solid var(--crt-dim);
      padding: 1rem;
      background: rgba(0,0,0,0.35);
      box-shadow: 0 0 18px var(--crt-glow);
      color: var(--crt-orange);
      border-radius: 4px;
    }

    /* subtle top accent line for modules */
    .module {
      position: relative;
      overflow: hidden;
    }
    .module::before {
      content: '';
      position: absolute;
      left:0; right:0; top:0; height:3px;
      background: linear-gradient(90deg, rgba(0,0,0,0), var(--accent), rgba(0,0,0,0));
      opacity: 0.08;
      pointer-events:none;
    }

    /* small terminal separators */
    .term-sep {
      color: var(--muted);
      margin: 0.5rem 0;
      font-size: 0.9rem;
    }

    /* scanlines overlay */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,0),
        rgba(0,0,0,0) 2px,
        rgba(0,0,0,0.03) 3px,
        rgba(0,0,0,0.03) 4px
      );
      mix-blend-mode: multiply;
    }

    /* subtle tube flicker */
    @keyframes tubeFlicker {
      0% { opacity: .98; filter: drop-shadow(0 0 4px rgba(255,152,0,0.05)); }
      50% { opacity: 1; filter: drop-shadow(0 0 6px rgba(255,152,0,0.08)); }
      100% { opacity: .99; filter: drop-shadow(0 0 4px rgba(255,152,0,0.05)); }
    }
    body { animation: tubeFlicker 3.6s infinite; }

    /* terminal cursor class for headings */
    .cursor::after {
      content: "_";
      margin-left: 6px;
      opacity: 1;
      animation: blink 1s steps(2) infinite;
      color: var(--crt-orange);
    }
    @keyframes blink { 50% { opacity: 0; } }

    /* small utility */
    .mono { font-family: "Source Code Pro", monospace; font-size:0.95rem; }
    .muted { color: var(--muted); }
    .small { font-size:0.86rem; }

    /* status dot override for contrast */
    .status-dot { width: 12px; height:12px; border-radius:50%; margin-right:8px; display:inline-block; }
    .online{ background: #57d16b; box-shadow: 0 0 8px rgba(87,209,107,0.12); }
    .idle{ background:#f0b232; box-shadow:0 0 8px rgba(240,178,50,0.08); }
    .dnd{ background:#f23f43; box-shadow:0 0 8px rgba(242,63,67,0.08); }
    .offline{ background:#6b6b6b; }

    /* headings small sizes on sections to fit terminal vibe */
    .section-title { font-size: 1rem; margin-bottom: 0.75rem; text-transform:uppercase; letter-spacing:1px; color:var(--crt-orange); }

    /* hero stays image-backed but tinted */
    .hero-bg {
      background-image:
        linear-gradient(to bottom, rgba(3,3,3,0.9), rgba(3,3,3,0.95)),
        url("titel_background.png");
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      color: var(--crt-orange);
      text-shadow:none;
    }

    /* adjust three.js plane color later via JS */
    #terrain { z-index:0; }

    /* responsive tweaks */
    @media (max-width:640px) {
      .glass, .terminal-box { padding: .65rem; }
      .hero-bg h1 { font-size: 2rem; }
      .hero-bg p { font-size: 0.95rem; }
    }

  </style>
</head>

<body>
  <canvas id="terrain"></canvas>
  <div id="root" style="position:relative; z-index:10;"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const DISCORD_ID = "780384263987920937";
    const STEAM_ID = "76561199474685726";
    const GITHUB_USER = "David-Unterberger";

    /* ---------------- HERO ---------------- */
    function Hero() {
      const roles = ["Game Developer", "Systems Programmer", "Procedural Enthusiast"];
      const [i, setI] = useState(0);
      useEffect(() => {
        const t = setInterval(() => setI(x => (x + 1) % roles.length), 3000);
        return () => clearInterval(t);
      }, []);
      return (
        <section className="hero-bg min-h-screen flex flex-col justify-center items-center text-center px-6">
          <h1 className="text-5xl md:text-6xl font-bold mb-4 mono">David Unterberger</h1>
          <div className="term-sep mono muted">========================================</div>
          <p className="text-lg mono muted max-w-2xl mb-6">
            Hobby game developer since 2020. Focused on procedural terrain, simulation systems and shader experimentation.
          </p>
          <div className="text-xl mono" style={{ color: "var(--crt-orange)" }}>{roles[i]}</div>
        </section>
      );
    }

    /* ---------------- CURRENT PROJECT ---------------- */
    function CurrentProject() {
      return (
        <section className="max-w-5xl mx-auto px-6 py-12">
          <div className="module terminal-box">
            <div className="section-title cursor">:: current project</div>
            <div className="mono small">
              <div>NAME........... Procedural Terrain & Shader Engine Experiments</div>
              <div className="muted term-sep">------------------------------------------</div>
              <div>
                Building modular terrain systems using layered noise stacks, runtime mesh deformation and custom shader pipelines.
                Exploring simulation-driven world generation.
              </div>
              <div className="term-sep muted">------------------------------------------</div>
              <div className="mt-3">
                <span className="mono">TAGS:</span> <span className="muted">C# • Shaders • Procedural Gen • Simulation</span>
              </div>
              <div className="mt-3">
                <a href="https://github.com/David-Unterberger" target="_blank" rel="noreferrer">github</a> • <a href="https://davebbx.itch.io" target="_blank" rel="noreferrer">itch.io</a>
              </div>
            </div>
          </div>
        </section>
      );
    }

    /* ---------------- DISCORD (terminal style) ---------------- */
    function Discord() {
      const [data, setData] = useState(null);
      const [elapsed, setElapsed] = useState("");

      // poll Lanyard
      useEffect(() => {
        let mounted = true;
        async function fetchPresence() {
          try {
            const r = await fetch(`https://api.lanyard.rest/v1/users/${DISCORD_ID}`);
            const json = await r.json();
            if (json.success && mounted) setData(json.data);
          } catch (e) { /* ignore */ }
        }
        fetchPresence();
        const id = setInterval(fetchPresence, 15000);
        return () => { mounted = false; clearInterval(id); };
      }, []);

      // derived
      const activity = data?.activities?.find(a => a.type === 0);

      // elapsed timer
      useEffect(() => {
        if (!activity?.timestamps?.start) { setElapsed(""); return; }
        function updateElapsed() {
          const start = Number(activity.timestamps.start);
          const diff = Date.now() - start;
          const hours = Math.floor(diff / (1000 * 60 * 60));
          const minutes = Math.floor((diff / (1000 * 60)) % 60);
          setElapsed(hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`);
        }
        updateElapsed();
        const id = setInterval(updateElapsed, 60000);
        return () => clearInterval(id);
      }, [activity]);

      // wait for data
      if (!data) return null;

      const user = data.discord_user;
      const status = data.discord_status || "offline";
      const customStatus = data.activities?.find(a => a.type === 4);

      // account age
      let accountAgeDays = null;
      try {
        const snowflake = BigInt(user.id);
        const timestamp = Number((snowflake >> 22n) + 1420070400000n);
        const createdAt = new Date(timestamp);
        accountAgeDays = Math.floor((Date.now() - createdAt.getTime()) / (1000 * 60 * 60 * 24));
      } catch (e) { /* ignore */ }

      // accent color fallback
      const accent = user?.accent_color ? `#${user.accent_color.toString(16).padStart(6,"0")}` : "#b56fff";

      function getActivityImage(act) {
        if (!act?.assets?.large_image) {
          // fallback for known apps like VS Code
          if (typeof act?.name === "string" && act.name.toLowerCase().includes("visual studio")) {
            return "https://upload.wikimedia.org/wikipedia/commons/9/9a/Visual_Studio_Code_1.35_icon.svg";
          }
          if (typeof act?.name === "string" && act.name.toLowerCase().includes("code")) {
            return "https://upload.wikimedia.org/wikipedia/commons/9/9a/Visual_Studio_Code_1.35_icon.svg";
          }
          return null;
        }

        const large = act.assets.large_image;
        if (typeof large === "string" && large.startsWith("mp:")) {
          return `https://media.discordapp.net/${large.replace("mp:", "")}`;
        }
        if (act.application_id) {
          return `https://cdn.discordapp.com/app-assets/${act.application_id}/${large}.png`;
        }
        return null;
      }

      const party = activity?.party?.size;

      return (
        <section className="max-w-5xl mx-auto px-6 py-12">
          <div className="module terminal-box">
            <div className="section-title cursor">:: discord module</div>
            <div className="mono small muted term-sep">========================================</div>

            <div className="mono small">
              <div>USER............. <span style={{color:"var(--crt-orange)", fontWeight:600}}>{user.username}</span></div>
              <div>STATUS........... <span className="muted">{status}</span></div>
              {accountAgeDays !== null && <div>ACCOUNT_AGE...... <span className="muted">{accountAgeDays} days</span></div>}
              {customStatus?.state && <div>CUSTOM_STATUS.... <span className="muted">{customStatus.emoji?.name} {customStatus.state}</span></div>}
            </div>

            {activity && (
              <>
                <div style={{height:8}} />
                <div className="glass small" style={{display:"flex", gap:12, alignItems:"center"}}>
                  <div style={{width:128, height:72, background:"#000", display:"flex", alignItems:"center", justifyContent:"center"}}>
                    {getActivityImage(activity) ? (
                      <img src={getActivityImage(activity)} style={{width:"100%", height:"100%", objectFit:"cover"}} alt="art" />
                    ) : (
                      <div className="muted small">No art</div>
                    )}
                  </div>

                  <div style={{flex:1}}>
                    <div className="mono" style={{fontWeight:700}}>{activity.name}</div>
                    {activity.details && <div className="muted small">{activity.details}</div>}
                    {activity.state && <div className="muted small">{activity.state}</div>}
                    {elapsed && <div className="muted small" style={{marginTop:8}}>{elapsed} elapsed</div>}
                    {party && <div className="muted small" style={{marginTop:6}}>Party: {party[0]} / {party[1]}</div>}
                  </div>
                </div>
              </>
            )}

            <div style={{height:12}} />
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
              <div style={{background:"rgba(0,0,0,0.25)", padding:8, border:"1px solid var(--crt-dim)"}}>
                <div className="muted small">Status</div>
                <div className="mono">{status}</div>
              </div>

              <div style={{background:"rgba(0,0,0,0.25)", padding:8, border:"1px solid var(--crt-dim)"}}>
                <div className="muted small">Activities</div>
                <div className="mono">{data.activities?.filter(a => a.type !== 4).length}</div>
              </div>

              <div style={{background:"rgba(0,0,0,0.25)", padding:8, border:"1px solid var(--crt-dim)"}}>
                <div className="muted small">User ID</div>
                <div className="mono small break-all">{user.id}</div>
              </div>

              <div style={{background:"rgba(0,0,0,0.25)", padding:8, border:"1px solid var(--crt-dim)"}}>
                <div className="muted small">Public Flags</div>
                <div className="mono">{user.public_flags || 0}</div>
              </div>
            </div>

          </div>
        </section>
      );
    }

    /* ---------------- STEAM (terminal style lists) ---------------- */
    function Steam() {
      const [data, setData] = useState(null);
      const [error, setError] = useState(false);

      useEffect(() => {
        fetch("/api/steam")
          .then(r => { if (!r.ok) throw new Error("steam fetch"); return r.json(); })
          .then(d => setData(d))
          .catch(() => setError(true));
      }, []);

      if (error) {
        return (
          <section className="max-w-5xl mx-auto px-6 py-20">
            <div className="terminal-box">
              <div className="section-title cursor">:: steam</div>
              <div className="mono muted">Steam data unavailable.</div>
            </div>
          </section>
        );
      }

      if (!data) return null;

      const profile = data.profile || {};
      const owned = data.owned || { game_count: 0 };
      const topPlayed = (data.topPlayed || []).slice(0, 9);
      const recent = (data.recent?.games || []).slice(0, 3);
      const totalHours = data.totalHours || 0;

      function fmtUnixSeconds(sec) {
        if (!sec) return "Unknown";
        const d = new Date(sec * 1000);
        return d.toLocaleString();
      }

      return (
        <section className="max-w-5xl mx-auto px-6 py-12">
          <div className="module terminal-box">
            <div className="section-title cursor">:: steam</div>
            <div className="mono muted term-sep">========================================</div>

            <div className="mono small">
              <div>PROFILE.......... <span style={{color:"var(--crt-orange)", fontWeight:700}}>{profile.personaname}</span></div>
              <div>TOTAL_GAMES...... <span className="muted">{owned.game_count || 0}</span></div>
              <div>TOTAL_HOURS...... <span className="muted">{totalHours} hrs</span></div>
              <div>CREATED.......... <span className="muted">{fmtUnixSeconds(profile.timecreated)}</span></div>
              <div>LAST_LOGOFF...... <span className="muted">{fmtUnixSeconds(profile.lastlogoff)}</span></div>
            </div>

            <div style={{height:12}} />

            <div className="mono small">
              <div className="muted">-- recently played --</div>
              {recent.map((g, i) => (
                <div key={g.appid} style={{display:"flex", justifyContent:"space-between", paddingTop:6}}>
                  <div>[{String(i+1).padStart(2,"0")}] {g.name}</div>
                  <div className="muted">{Math.round((g.playtime_2weeks||0)/60)}h</div>
                </div>
              ))}
            </div>

            <div style={{height:12}} />

            <div className="mono small">
              <div className="muted">-- top played --</div>
              {topPlayed.map((g,i) => (
                <div key={g.appid} style={{display:"flex", justifyContent:"space-between", paddingTop:6}}>
                  <div>[{String(i+1).padStart(2,"0")}] {g.name}</div>
                  <div className="muted">{Math.round((g.playtime_forever||0)/60)}h {g.completion_percent !== null ? ` • ${g.completion_percent}%` : ""}</div>
                </div>
              ))}
            </div>

          </div>
        </section>
      );
    }

    /* ---------------- GITHUB (terminal style) ---------------- */
    function Github() {
      const [profile, setProfile] = useState(null);
      const [repos, setRepos] = useState([]);
      const username = GITHUB_USER;

      useEffect(() => {
        fetch(`https://api.github.com/users/${username}`)
          .then(r => r.json())
          .then(setProfile)
          .catch(() => { });

        fetch(`https://api.github.com/users/${username}/repos?per_page=100&sort=pushed`)
          .then(r => r.json())
          .then(list => {
            if (Array.isArray(list)) setRepos(list);
          })
          .catch(() => { });
      }, []);

      if (!profile) return null;

      const totals = repos.reduce((acc, r) => {
        acc.stars += (r.stargazers_count || 0);
        acc.forks += (r.forks_count || 0);
        if (r.language) acc.langCount[r.language] = (acc.langCount[r.language] || 0) + 1;
        if (!acc.top || r.stargazers_count > acc.top.stars) acc.top = { name: r.name, stars: r.stargazers_count, url: r.html_url };
        return acc;
      }, { stars: 0, forks: 0, langCount: {}, top: null });

      const mostUsedLanguage = Object.entries(totals.langCount).sort((a,b)=>b[1]-a[1])[0]?.[0] || "Unknown";
      const contributionsSvg = `https://ghchart.rshah.org/${username}`;

      return (
        <section className="max-w-5xl mx-auto px-6 py-12">
          <div className="module terminal-box">
            <div className="section-title cursor">:: github</div>
            <div className="mono muted term-sep">========================================</div>

            <div className="mono small">
              <div>USER............. <span style={{color:"var(--crt-orange)", fontWeight:700}}>{profile.name || profile.login}</span></div>
              <div>BIO.............. <span className="muted">{profile.bio || "—"}</span></div>
              <div>PUBLIC_REPOS..... <span className="muted">{profile.public_repos}</span></div>
              <div>TOTAL_STARS...... <span className="muted">{totals.stars}</span></div>
              <div>TOTAL_FORKS...... <span className="muted">{totals.forks}</span></div>
              <div>TOP_LANGUAGE..... <span className="muted">{mostUsedLanguage}</span></div>
              {totals.top && <div className="mt-2">MOST_STARRED..... <a href={totals.top.url} target="_blank" rel="noreferrer" className="muted">{totals.top.name} ({totals.top.stars}★)</a></div>}
            </div>

            <div style={{height:12}} />

            <div className="glass small">
              <div className="muted small mb-2">Contribution graph</div>
              <img src={contributionsSvg} alt="contributions" style={{width:"100%", display:"block"}} />
              <div className="text-xs muted mt-2">Commit graph (public service image)</div>
            </div>

            <div style={{height:12}} />

            <div className="mono small">
              <div className="muted">-- top repositories --</div>
              {repos.slice(0,6).map(r => (
                <div key={r.id} style={{display:"flex", justifyContent:"space-between", paddingTop:6}}>
                  <a href={r.html_url} target="_blank" rel="noreferrer" style={{color:"var(--crt-orange)"}}>{r.name}</a>
                  <div className="muted small">★{r.stargazers_count}</div>
                </div>
              ))}
            </div>

          </div>
        </section>
      );
    }

    /* ---------------- WEATHER ---------------- */
    function Weather() {
      const [weather, setWeather] = useState(null);
      useEffect(() => {
        fetch("https://api.open-meteo.com/v1/forecast?latitude=47.8095&longitude=13.0550&current_weather=true")
          .then(r => r.json()).then(d => setWeather(d.current_weather)).catch(() => { });
      }, []);
      if (!weather) return null;
      return (
        <section className="max-w-5xl mx-auto px-6 py-12">
          <div className="terminal-box">
            <div className="section-title cursor">:: salzburg weather</div>
            <div className="mono muted term-sep">========================================</div>
            <div className="mono small">
              <div>TEMP.............. <span style={{color:"var(--crt-orange)", fontWeight:700}}>{weather.temperature}°C</span></div>
              <div>WIND.............. <span className="muted">{weather.windspeed} km/h</span></div>
            </div>
          </div>
        </section>
      );
    }

    /* ---------------- APP ---------------- */
    function App() {
      return (
        <>
          <Hero />
          <CurrentProject />
          <Discord />
          <Steam />
          <Github />
          <Weather />
          <footer className="text-center py-12 muted mono">David Unterberger</footer>
        </>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);

  </script>

  <script>
    // Terrain Animation — adjust color to match orange CRT
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("terrain"), alpha: true });
    renderer.setClearColor(0x000000, 0);
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.position.z = 30;

    const geometry = new THREE.PlaneGeometry(120, 120, 120, 120);
    // warm orange, low opacity
    const material = new THREE.MeshBasicMaterial({
      color: 0xff8a2b,
      wireframe: true,
      transparent: true,
      opacity: 0.06
    });

    const plane = new THREE.Mesh(geometry, material);
    plane.rotation.x = -Math.PI / 2.7;
    scene.add(plane);

    function animate() {
      requestAnimationFrame(animate);
      const t = Date.now() * 0.0003;
      const pos = plane.geometry.attributes.position;
      for (let i = 0; i < pos.count; i++) {
        const x = pos.getX(i), y = pos.getY(i);
        pos.setZ(i, Math.sin(x * 0.2 + t) * 0.4 + Math.cos(y * 0.25 + t) * 0.4);
      }
      pos.needsUpdate = true;
      renderer.render(scene, camera);
    }
    animate();

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>

</html>